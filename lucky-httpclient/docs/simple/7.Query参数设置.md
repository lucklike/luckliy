## ğŸ˜¬ Queryå‚æ•°è®¾ç½®

---
Queryå‚æ•°ï¼Œä¹Ÿç§°ä¸º URL æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå³è·Ÿåœ¨ URL åœ°å€ä¸­?åé¢çš„é‚£ä¸²å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨=è¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ï¼Œå¤šä¸ªé”®å€¼å¯¹ç”¨&éš”å¼€ï¼Œå…¶å¯ä»¥ä½œä¸º HTTP è¯·æ±‚çš„å‚æ•°
é€šè¿‡è¿™äº›å‚æ•°å¯ä»¥å‘Šè¯‰æœåŠ¡ç«¯è¦åšå“ªäº›äº‹æƒ…ï¼Œä»¥åŠè¿™äº›äº‹ç›¸å…³çš„æ•°æ®ï¼ˆç®€å•æ•°æ®ï¼Œæ•°æ®å¤§å°å—åˆ° URL é•¿åº¦æ ‡å‡†çš„é™åˆ¶ï¼‰  

åœ¨`lucky`ä¸­é…ç½®`Query`å‚æ•°çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä¸€ä¸€ä»‹ç»

---
### #ä½¿ç”¨`SpEL`è¡¨è¾¾å¼æ¥è®¾ç½®
ä»¥è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ä¸ºä¾‹ï¼Œæ¥å£éœ€è¦ä»¥Queryçš„æ–¹å¼ä¼ é€’ç”¨æˆ·IDã€‚  
ä¾‹å¦‚ï¼š  
è¦æŸ¥è¯¢IDä¸ºâ€˜u1234â€™çš„ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆURLåº”è¯¥è¿™æ ·å†™ï¼š  
`http://localhost:8080/user/getOne?id=u1234`

```java
@DomainName("http://localhost:8080/user/")
public interface UserApi {

    // ä½¿ç”¨å‚æ•°ç´¢å¼•å®šä½å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°
    @Get("/getOne?id=#{p0}")
    User getUser1(String id);

    // ä½¿ç”¨å‚æ•°åæ¥è·å–å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ï¼Œä½¿ç”¨@Paramæ¥å®šä¹‰å‚æ•°å
    @Get("/getOne?id=#{id}")
    User getUser2(@Param("id") String id);

}
```

ğŸ‘ æ¨èåœ¨Mavençš„`pom.xml`ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®æ¥æ·»åŠ `-parameters`ç¼–è¯‘å‚æ•°
```xml
<!-- è®¾ç½®ç¼–è¯‘ç‰ˆæœ¬ä¸º1.8 ï¼Œ æ·»åŠ ç¼–è¯‘å‚æ•°-parameters -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <configuration>
        <source>1.8</source>
        <target>1.8</target>
        <encoding>UTF-8</encoding>
        <parameters>true</parameters>
    </configuration>
    <version>3.8.1</version>
</plugin>
```

æ·»åŠ ä¹‹å`lucky`ä¾¿å¯ä»¥ä¸ç”¨å€ŸåŠ©`@Param`æ³¨è§£æ¥å®šä¹‰æ–¹æ³•å‚æ•°åï¼Œä¸Šè¿°`getUser2`æ–¹æ³•ä¾¿å¯ä»¥çœç•¥`@Param`æ³¨è§£äº†
```java
@DomainName("http://localhost:8080/user/")
public interface UserApi {
    
    // æ·»åŠ `-parameters`ç¼–è¯‘å‚æ•°åï¼Œä¾¿å¯ä»¥ä¸å€ŸåŠ©@Paramç›´æ¥é€šè¿‡å‚æ•°åæ¥è·å–å‚æ•°
    @Get("/getOne?id=#{id}")
    User getUser2(String id);

}
```

---

### #ä½¿ç”¨`@QueryParam`æ³¨è§£æ¥è®¾ç½®
ä¸Šè¿°åŒæ ·çš„éœ€æ±‚å€ŸåŠ©`@QueryParam`ä¹Ÿå¯ä»¥è¿™æ ·ä½¿ç”¨

```java
@DomainName("http://localhost:8080/user/")
public interface UserApi {

    @Get("/getOne")
    User getUser2(@QueryParam("id") String id);

    /*
        å‚æ•°åˆ—è¡¨ä¸­å­˜åœ¨å¤šä¸ªQueryå‚æ•°æ—¶ï¼Œå¯ä»¥å°†@QueryParamæ³¨è§£æåˆ°æ–¹æ³•ä¸Šæ¥è¿›è¡Œç»Ÿä¸€é…ç½®
        æ­¤åŠŸèƒ½å»ºè®®åœ¨æ·»åŠ `-parameters`ç¼–è¯‘å‚æ•°åä½¿ç”¨
     */
    @Get("/getOne")
    @QueryParam
    User getUser3(String id, Long time);

    /*
        å‚æ•°åˆ—è¡¨ä¸­å­˜åœ¨å¤šä¸ªQueryå‚æ•°æ—¶ï¼Œä½†åˆä¸å…¨æ˜¯Queryæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ @NotHttpParamæ³¨è§£æ¥è¿›è¡Œæ’é™¤   
     */
    @Get("/getOne")
    @QueryParam
    User getUser4(String id, Long time, @NotHttpParam String nonQuery);
    
    /*
        å¯ä»¥ä½¿ç”¨Mapæ¥æ‰¹é‡æ·»åŠ Queryå‚æ•°    
     */
    @Get("/getOne")
    User getUser5(@QueryParam Map<String, Object> queryMap);

    /*
        å½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨å¯¹è±¡æ¥æ‰¹é‡æ·»åŠ Queryå‚æ•°    
    */
    @Get("/getOne")
    User getUser6(@QueryParam QueryEntity queryObj);
}
```

---
### #ä½¿ç”¨`@StaticQuery`æ³¨è§£æ¥è®¾ç½®
`@StaticQuery`æ³¨è§£ä¸€èˆ¬ç”¨äºé…ç½®ä¸€äº›å›ºå®šçš„Queryå‚æ•°

```java
import com.luckyframework.httpclient.proxy.annotations.StaticQuery;

@DomainName("http://localhost:8080/user/")
public interface UserApi {

    // å–å‚æ•°åˆ—è¡¨ä¸­çš„å€¼
    @StaticQuery({"id=#{id}"})
    @Get("/getOne)
    User getUser(String id);
    
    @StaticQuery({
        "id=#{id}",
        "_time=#{#time()}", // ä½¿ç”¨å†…ç½®SpELå‡½æ•°"#time()"æ·»åŠ å½“å‰æ—¶é—´æˆ³å‚æ•°   
        "appId=${local.api.appId}" //å–ç¯å¢ƒå˜é‡ä¸­çš„é…ç½®    
    })
    User getUser2(String id);
}

```

---
### #URLEncodeç¼–ç 

1. ä½¿ç”¨å†…ç½®çš„`SpEL`å‡½æ•°`#url()`æ¥è¿›è¡ŒURLEncodeç¼–ç 

```java
@DomainName("http://localhost:8080/user/")
public interface UserApi {

    // Queryå‚æ•°ä¸­nameå‚æ•°ä¸ºä¸­æ–‡ï¼Œéœ€è¦å¯¹å®ƒè¿›è¡ŒURLEncodeç¼–ç ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨UTF-8è¿›è¡Œç¼–ç 
    @Get("/getOne?id=#{id}&name=#{#url(name)}")
    User getUser(String id, String name);

    @StaticQuery({
        "id=#{id}",
        "name=#{#url(name)}"    
    })
    @Get("/getOne)
    User getUser(String id, String name);


    // å¦‚æœéœ€è¦æŒ‡å®šå…¶ä»–ç¼–ç æ ¼å¼ï¼Œä¾‹å¦‚éœ€è¦ä½¿ç”¨'ISO_8859_1'ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ¥è¿›è¡Œè®¾ç½®
    @Get("/getOne?id=#{id}&name=#{#url(name, 'ISO_8859_1')}")
    User getUser(String id, String name);
}
```

2. ä½¿ç”¨`@URLEncoderQuery`æ³¨è§£æ¥è¿›è¡ŒURLEncodeç¼–ç 

```java
@DomainName("http://localhost:8080/user/")
public interface UserApi {

    // Queryå‚æ•°ä¸­nameå‚æ•°ä¸ºä¸­æ–‡ï¼Œéœ€è¦å¯¹å®ƒè¿›è¡ŒURLEncodeç¼–ç ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨UTF-8è¿›è¡Œç¼–ç 
    @Get("/getOne")
    User getUser(@QueryParam String id, @URLEncoderQuery String name);

    // å¦‚æœéœ€è¦æŒ‡å®šå…¶ä»–ç¼–ç æ ¼å¼ï¼Œä¾‹å¦‚éœ€è¦ä½¿ç”¨'ISO_8859_1'
    @Get("/getOne")
    User getUser(@QueryParam String id, @URLEncoderQuery(charset = "ISO_8859_1") String name);

}
```
