## ğŸ¤— Jsonå‚æ•°è®¾ç½®


åœ¨ HTTP ä¸­ï¼Œ`application/json` æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ MIME ç±»å‹ï¼ˆä¹Ÿç§°ä¸ºåª’ä½“ç±»å‹æˆ–å†…å®¹ç±»å‹ï¼‰ï¼Œç”¨äºè¡¨ç¤º JSON æ ¼å¼çš„æ•°æ®ã€‚JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå¹¿æ³›ç”¨äº Web æœåŠ¡ä¸­ä½œä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„æ ¼å¼ã€‚

> `lucky`ä¸­é»˜è®¤ä½¿ç”¨çš„`JSON`æ¡†æ¶ä¸º`Jackson`ï¼Œåœ¨ä½¿ç”¨`JSON`åŠŸèƒ½æ—¶å¯ä»¥ç»“åˆ`Jackson`æ³¨è§£æ¥ä½¿ç”¨ã€‚åºåˆ—åŒ–æ¡†æ¶å¯ä»¥æ›´æ¢ï¼Œæ›´æ¢æ–¹æ³•å°†åœ¨åç»­çš„`æ‰©å±•ç¯‡`ä¸­è¯¦ç»†ä»‹ç»

---

### #ä½¿ç”¨`@JsonBody`æ³¨è§£æ¥è®¾ç½®`JSON`å‚æ•°

```java
/*
    ã€ä½¿ç”¨Mapä½œä¸ºå…¥å‚ã€‘    
    Map<String, Object> jsonMap = new LinkedHashMap<>();
    jsonMap.put("name", "Tom");
    jsonMap.put("age", "28");
    jsonMap.put("interest", Arrays.asList("ç¯®çƒ", "ç¾½æ¯›çƒ", "å†™ä»£ç "));
    jsonTest(jsonMap);
    
    -->
    
    POST http://localhost:8080/json
    User-Agent: Lucky-HttpClient/3.0.1 (Java/1.8.0_432)
    Content-Type: application/json;charset=UTF-8

    {
      "name" : "Tom",
      "age" : "28",
      "interest" : [ "ç¯®çƒ", "ç¾½æ¯›çƒ", "å†™ä»£ç " ]
    }
 */
@Post("http://localhost:8080/json")
Map<String, Object> jsonTest(@JsonBody Map<String, Object> jsonMap);

/*
    ã€ä½¿ç”¨Javaå¯¹è±¡ä½œä¸ºå…¥å‚ã€‘    
    User user = new User();
    user.setId("1234");
    user.setName("Tom");
    user.setPhone("17366542234");
    user.setEmail("tom@gmail.com");
    user.setUserAddress(new String[]{"åœ°å€1", "åœ°å€2"});
    jsonTest2(user);

    -->
    
    POST http://localhost:8080/json
    User-Agent: Lucky-HttpClient/3.0.1 (Java/1.8.0_432)
    Content-Type: application/json;charset=UTF-8

    {
      "id" : "1234",
      "name" : "Tom",
      "email" : "tom@gmail.com",
      "phone" : "17366542234",
      "userAddress" : [ "åœ°å€1", "åœ°å€2" ]
    }    
 */
@Post("http://localhost:8080/json")
Map<String, Object> jsonTest2(@JsonBody User user);
```

---

### #ä½¿ç”¨`@JsonParam`æ³¨è§£æ¥è®¾ç½®ç®€å•`JSON`å‚æ•°
å¦‚æœä½ æ­£åœ¨ä½¿ç”¨çš„æ¥å£çš„Jsonå‚æ•°ç»“æ„å¾ˆç®€å•ï¼Œä½ ä¸æƒ³ä½¿ç”¨Mapä¹Ÿä¸æƒ³å°è£…å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥è¯•è¯•`@JsonParam`æ³¨è§£ã€‚

```java
import com.luckyframework.httpclient.proxy.annotations.NotHttpParam;

/*
    jsonParam("Jack", 18);
    
    -->
    
    POST http://localhost:8080/json
    User-Agent: Lucky-HttpClient/3.0.1 (Java/1.8.0_432)
    Content-Type: application/json;charset=UTF-8

    {
      "userName" : "Jack",
      "age" : 18
    }
 */
@Post("http://localhost:8080/json")
Map<String, Object> jsonParam(@JsonParam("userName") String name, @JsonParam Integer age);

// å½“æ–¹æ³•å‚æ•°åˆ—è¡¨å¤§éƒ¨åˆ†éƒ½æ˜¯Jsonå‚æ•°æ—¶ï¼Œå¯ä»¥å°†@JsonParamæ³¨è§£æåˆ°æ–¹æ³•ä¸Š, å¦‚æœæŸä¸ªå‚æ•°ä¸æ˜¯Jsonå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨@NotHttpParamæ¥æ’é™¤
@JsonParam
@Post("http://localhost:8080/json")
Map<String, Object> jsonParam2(String name, Integer age, @NotHttpParam String notJsonParam);
```

---
### #ä½¿ç”¨`@StaticJsonBody`æ³¨è§£ä»¥æ›´åŠ `æ¥è¿‘åŸç”Ÿ`çš„æ–¹å¼æ¥è®¾ç½®`Json`å‚æ•°

```java
/*
    ç›´æ¥é…ç½®åŸå§‹çš„JSONå­—ç¬¦ä¸²
 */
@StaticJsonBody("{\"userName\" : \"Jack\", \"age\" : 18}")
@Post("http://localhost:8080/json")
Map<String, Object> staticJsonBody();

/*
    å½“ç„¶ä¹Ÿæ˜¯æ”¯æŒSpELè¡¨è¾¾å¼çš„ï¼Œ#{name}ï¼šå–å‚æ•°åˆ—è¡¨ä¸­åç§°ä¸ºnameçš„å‚æ•°
 */
@StaticJsonBody("{\"userName\" : \"#{name}\", \"age\" : 18}")
@Post("http://localhost:8080/json")
Map<String, Object> staticJsonBody(String name);
```

> `@StaticJsonBody`æ³¨è§£è¿˜æœ‰ä¸ªå¾ˆå¦™çš„ç”¨æ³•ï¼Œé‚£å°±æ˜¯å¯ä»¥ç›´æ¥è¯»Jsonæ–‡ä»¶ä¸­çš„æ•°æ®æ¥ä½œä¸ºå…¥å‚ã€‚  
ä¾‹å¦‚ï¼Œæˆ‘æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼š`book.json`ï¼Œæ–‡ä»¶ä½äº`classpath`ä¸‹ï¼Œæ–‡ä»¶ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š
```json
{
  "code": 200,
  "success": true,
  "message": "Successful",
  "data": [
    {
      "book-name": "BOOK-NAME",
      "book-author": "JACKFU",
      "book-publisher": "å‘å¸ƒäººæµ‹è¯•",
      "book-price": 123.6,
      "book-a": "a",
      "book-b": "b"
    }
  ]
}
```

å¯ä»¥ç›´æ¥ä½¿ç”¨å¦‚ä¸‹å†…ç½®çš„`SpELå‡½æ•°`æ¥è·å–æ–‡ä»¶å†…å®¹:    
`#{#read(#resource('classpath:book.json'))}`

```java

/*
    staticJsonBody()
    
    -->
    
    POST http://localhost:8080/json
    User-Agent: Lucky-HttpClient/3.0.1 (Java/1.8.0_432)
    Content-Type: application/json;charset=UTF-8

    {
      "code" : 200,
      "success" : true,
      "message" : "Successful",
      "data" : [ {
        "book-name" : "BOOK-NAME",
        "book-author" : "JACKFU",
        "book-publisher" : "å‘å¸ƒäººæµ‹è¯•",
        "book-price" : 123.6,
        "book-a" : "a",
        "book-b" : "b"
      } ]
    }
 */
@StaticJsonBody("#{#read(#resource('classpath:book.json'))}")
@Post("http://localhost:8080/json")
Map<String, Object> staticJsonBody();
```

> å½“ç„¶ï¼ŒJsonæ–‡ä»¶ä¸­çš„Jsonæ•°æ®ä¹Ÿæ˜¯æ”¯æŒä¼ å‚çš„å“¦ï¼ï¼ï¼ï¼

åŒæ ·æ˜¯ä¸Šé¢çš„`classpath:book.json`ï¼Œæˆ‘ä»¬å¸Œæœ›`book-a`å’Œ`book-b`è¿™ä¸¤ä¸ªå‚æ•°ä¸èƒ½å†™æ­»ï¼Œè€Œæ˜¯é€šè¿‡æ–¹æ³•å‚æ•°æ¥è®¾ç½®ã€‚é‚£æˆ‘ä»¬å¯ä»¥è¿™æ ·æ”¹é€ ä¸€ä¸‹ï¼š
- "book-a": "#{bookA}"  --> ç»‘å®šå‚æ•°åˆ—è¡¨ä¸­çš„bookAå‚æ•°
- "book-b": "#{bookB}"  --> ç»‘å®šå‚æ•°åˆ—è¡¨ä¸­çš„bookBå‚æ•°
```json
{
  "code": 200,
  "success": true,
  "message": "Successful",
  "data": [
    {
      "book-name": "BOOK-NAME",
      "book-author": "JACKFU",
      "book-publisher": "å‘å¸ƒäººæµ‹è¯•",
      "book-price": 123.6,
      "book-a": "#{bookA}",
      "book-b": "#{bookB}"
    }
  ]
}
```

å¯¹åº”çš„ä¹Ÿéœ€è¦æ”¹é€ SpELè¡¨è¾¾å¼:  
#{#read(#resource('classpath:book.json'))}  
->   
\`\`#{#read(#resource('classpath:book.json'))}\`\`

è¯´æ˜ï¼šå†SpELè¡¨è¾¾å¼çš„å‰ååŠ ä¸Šä¸¤ä¸ªåå¼•å·ï¼ˆ\`\`ï¼‰ä¹‹åï¼Œè¯¥SpELè¡¨è¾¾å¼å°±æ”¯æŒåµŒå¥—è§£æäº†ï¼ˆå¦‚æœè§£æçš„ç»“æœä¸º`String`ç±»å‹ï¼Œè€Œä¸”ç»“æœä¸­è¿˜å°±å­˜åœ¨`#{}`ï¼Œé‚£ä¹ˆè¿™ä¸ªç»“æœå°†ä¼šè¢«ä½œä¸ºè¡¨è¾¾å¼å†æ¬¡è®¡ç®—ï¼Œç›´åˆ°æ²¡æœ‰`#{}`ä¸ºæ­¢ï¼ï¼‰

```java
/*
    staticJsonBody("ç‹­ä¹‰ç›¸å¯¹è®º", "å¹¿ä¹‰ç›¸å¯¹è®º");    
    
    -->
    
    POST http://localhost:8080/json
    User-Agent: Lucky-HttpClient/3.0.1 (Java/1.8.0_432)
    Content-Type: application/json;charset=UTF-8

    {
      "code" : 200,
      "success" : true,
      "message" : "Successful",
      "data" : [ {
        "book-name" : "BOOK-NAME",
        "book-author" : "JACKFU",
        "book-publisher" : "å‘å¸ƒäººæµ‹è¯•",
        "book-price" : 123.6,
        "book-a" : "ç‹­ä¹‰ç›¸å¯¹è®º",
        "book-b" : "å¹¿ä¹‰ç›¸å¯¹è®º"
      } ]
    }
 */
@StaticJsonBody("``#{#read(#resource('classpath:book.json'))}``")
@Post("http://localhost:8080/json")
Map<String, Object> staticJsonBody(String bookA, String bookB);
```

---
### #ä½¿ç”¨`@PropertiesJson`æ³¨è§£ä»¥`.properties`æ–‡ä»¶è¯­æ³•æ¥é…ç½®`JSON`å‚æ•°
ä½¿ç”¨`@StaticJsonBody`æ³¨è§£é…ç½®åŸç”ŸJSONå­—ç¬¦ä¸²æ—¶ï¼Œç”±äºJavaè¯­æ³•çš„åŸå› ï¼Œéœ€è¦å¯¹å¼•å·(`"`)è¿›è¡Œè½¬ä¹‰ï¼Œè¿™ä¼šå¯¼è‡´é…ç½®çš„JSONä¼šéå¸¸éš¾çœ‹ï¼Œä¸ºäº†è§£å†³è¯¥é—®é¢˜å¼•å…¥äº†
`@PropertiesJson`æ³¨è§£ï¼Œè¯¥æ³¨è§£æ”¯æŒä½¿ç”¨`.properties`æ–‡ä»¶è¯­æ³•æ¥æè¿°ä¸€ä¸ªJSONå¯¹è±¡,è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥æ¶ˆé™¤å¤§é‡çš„å¼•å·(`"`)  
ä¾‹å¦‚ï¼š
```json
{
  "id" : "1234",
  "name" : "Tom",
  "email" : "tom@gmail.com",
  "phone" : "17366542234",
  "userAddress" : [ "åœ°å€1", "åœ°å€2" ]
}
```

æ”¹é€ ä¸º`.properties`æ–‡ä»¶è¯­æ³•å

```properties
id=1234
name=Tom
email=tom@gmail.com
phone=17366542234
userAddress[0]=åœ°å€1
userAddress[1]=åœ°å€2
```

ç«‹é©¬åº”ç”¨èµ·æ¥ï¼š
```java


/*
    propertiesJson();

    -->
    
    POST http://localhost:8080/json
    User-Agent: Lucky-HttpClient/3.0.1 (Java/1.8.0_432)
    Content-Type: application/json;charset=UTF-8

    {
      "userAddress" : [ "åœ°å€1", "åœ°å€2" ],
      "phone" : "17366542234",
      "name" : "Tom",
      "id" : "1234",
      "email" : "tom@gmail.com"
    }
 */
@PropertiesJson({
    "id=1234",
    "name=Tom",
    "email=tom@gmail.com",
    "phone=17366542234",
    "userAddress[0]=åœ°å€1",
    "userAddress[1]=åœ°å€2"
})
@Post("http://localhost:8080/json")
Map<String, Object> propertiesJson();


/*
    å½“ç„¶ã€‚ä¹Ÿæ”¯æŒSpELè¡¨è¾¾å¼ 
 */
@PropertiesJson({
    "id=1234",
    "name=#{#uuid()}",          // ä½¿ç”¨å†…ç½®SpELå‡½æ•°
    "email=#{email}",           // å–å‚æ•°åˆ—è¡¨å€¼
    "phone=${user.tome.phone}", // å–ç¯å¢ƒå˜é‡ä¸­çš„é…ç½®
    "userAddress[0]=åœ°å€1",
    "userAddress[1]=åœ°å€2"
})
@Post("http://localhost:8080/json")
Map<String, Object> propertiesJson2(String email);

```

å¦å¤–`@PropertiesJson`æ³¨è§£è¿˜å¯ä»¥ä¸`@JsonParam`æ³¨è§£æ¥é…åˆä½¿ç”¨

```java
/*
    propertiesJson3("karl@qq.com", "1111", "Karl")
    
    -->
        
    POST http://localhost:8080/json
    User-Agent: Lucky-HttpClient/3.0.1 (Java/1.8.0_432)
    Content-Type: application/json;charset=UTF-8

    {
      "userAddress" : [ "åœ°å€1", "åœ°å€2" ],
      "phone" : "124",
      "id" : "1111",
      "userName" : "Karl",
      "email" : "karl@qq.com"
    }
 */
@PropertiesJson({
    "email=#{email}",           // å–å‚æ•°åˆ—è¡¨å€¼
    "phone=${user.tome.phone}", // å–ç¯å¢ƒå˜é‡ä¸­çš„é…ç½®
    "userAddress[0]=åœ°å€1",
    "userAddress[1]=åœ°å€2"
})
@Post("http://localhost:8080/json")
Map<String, Object> propertiesJson3(String email, @JsonParam String id, @JsonParam("userName") String name);
```

---

### #ä½¿ç”¨`@PropertiesJsonArray`æ³¨è§£æ¥é…ç½®æ•°ç»„ç±»å‹çš„`JSON`

```java

import com.luckyframework.httpclient.proxy.annotations.JsonParam;/*
    propertiesJsonArray();

    -->
    
    POST http://localhost:8080/json
    User-Agent: Lucky-HttpClient/3.0.1 (Java/1.8.0_432)
    Content-Type: application/json;charset=UTF-8

    [ {
      "id" : "111",
      "name" : "Jack"
    }, {
      "id" : "222",
      "name" : "Tom"
    } ]    
   
 */
@PropertiesJsonArray({
    "$[0].id=111",
    "$[0].name=Jack",
    "$[1].id=222",
    "$[1].name=Tom"
})
@Post("http://localhost:8080/json")
Map<String, Object> propertiesJsonArray();


/*
    æ”¯æŒSpELè¡¨è¾¾å¼    
 */
@PropertiesJsonArray({
    "$[0].id=#{p0}",               // å–å‚æ•°åˆ—è¡¨å€¼
    "$[0].name=${user.name}",      // ä½¿ç”¨å†…ç½®SpELå‡½æ•°
    "$[1].id=#{#randomMax(1000)}", // ä½¿ç”¨å†…ç½®SpELå‡½æ•°
    "$[1].name=Tom"
})
@Post("http://localhost:8080/json")
Map<String, Object> propertiesJsonArray1(String id1);


/*
    é…åˆ@JsonParamæ³¨è§£ä½¿ç”¨ 
 */
@PropertiesJsonArray({
    "$[0].id=1111",
    "$[0].name=${user.name}"
})
@Post("http://localhost:8080/json")
Map<String, Object> propertiesJsonArray1(@JsonParam("$[1].id") String id2, @JsonParam("$[1].name")String name2);
```