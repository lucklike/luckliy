## ğŸ¤© Formå‚æ•°è®¾ç½®

---
`application/x-www-form-urlencoded` æ˜¯ä¸€ç§ MIME ç±»å‹ï¼Œå¸¸ç”¨äº HTTP è¯·æ±‚ä¸­ä¼ é€’è¡¨å•æ•°æ®ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯å°†æ•°æ®ç¼–ç ä¸ºé”®å€¼å¯¹ï¼Œé”®å€¼å¯¹ä¹‹é—´ä½¿ç”¨ `&` åˆ†éš”ï¼Œé”®å’Œå€¼ä¹‹é—´ä½¿ç”¨ `=` è¿æ¥ã€‚

**æ•°æ®æ ¼å¼**

- ç¤ºä¾‹ï¼š
    ```http request
    key1=value1&key2=value2
    ```
- ç‰¹æ€§ï¼š

  - æ•°æ®ä¼šç»è¿‡ URL ç¼–ç ï¼ˆpercent-encodingï¼‰ï¼Œä»¥ç¡®ä¿ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼` `ã€`&`ã€`=`ï¼‰ä¸ä¼šå¹²æ‰°æ•°æ®çš„ä¼ è¾“ã€‚
  - ç©ºæ ¼ç¼–ç ä¸º `+`ï¼Œå…¶ä»–ç‰¹æ®Šå­—ç¬¦ç¼–ç ä¸º `%xx` æ ¼å¼ã€‚


---
### #ä½¿ç”¨`@FromParam`æ³¨è§£æ¥è®¾ç½®`Form`å‚æ•°

```java
/*
    formTest("Jack", 18, "jack@gmail.com");    
    
    -->
    
    POST http://localhost:8080/form
    User-Agent: Lucky-HttpClient/3.0.0 (Java/1.8.0_301)
    Content-Type: application/x-www-form-urlencoded
    
    name=Jack&age=18&email=jack@gmail.com
 */

@Post("http://localhost:8080/form")
String formTest(@FormParam String name, @FormParam Integer age, @FormParam String email);

/*
    å½“æ–¹æ³•å‚æ•°åˆ—è¡¨å¤§éƒ¨åˆ†éƒ½æ˜¯Formå‚æ•°æ—¶ï¼Œå¯ä»¥å°†@FormParamæ³¨è§£æåˆ°æ–¹æ³•ä¸Š, å¦‚æœæŸä¸ªå‚æ•°ä¸æ˜¯Formå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨@NotHttpParamæ¥æ’é™¤
    formTest2("Jack", 18, "jack@gmail.com", "ä¸æ˜¯Formå‚æ•°");    
    
    -->
    
    POST http://localhost:8080/form
    User-Agent: Lucky-HttpClient/3.0.0 (Java/1.8.0_301)
    Content-Type: application/x-www-form-urlencoded
    
    name=Jack&age=18&email=jack@gmail.com
 */
@FormParam
@Post("http://localhost:8080/form")
String formTest2(String name, Integer age, String email, @NotHttpParam String notFormParam);


// å¯ä»¥ä½¿ç”¨Mapæ¥æ‰¹é‡æ·»åŠ Formå‚æ•°  
@Post("http://localhost:8080/form")
String formTest3(@FormParam Map<String, Object> mapHeader);


// å½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨å¯¹è±¡æ¥æ‰¹é‡æ·»åŠ Formå‚æ•°    
@Post("http://localhost:8080/form")
String formTest4(@FormParam FormEntity objectForm);
```

---

### #ä½¿ç”¨`@StaticForm`æ³¨è§£æ¥è®¾ç½®`Form`å‚æ•°

1. **ç®€å•ä½¿ç”¨**
```java
@StaticForm({
    "name=#{p0}",                // ä½¿ç”¨ç´¢å¼•çš„æ–¹å¼å–å‚æ•°åˆ—è¡¨ä¸­çš„å€¼
    "age=#{age}",                // ä½¿ç”¨å‚æ•°åçš„æ–¹å¼å–å‚æ•°åˆ—è¡¨ä¸­çš„å€¼
    "email=#{email}",            // ä½¿ç”¨å‚æ•°åçš„æ–¹å¼å–å‚æ•°åˆ—è¡¨ä¸­çš„å€¼
    "test=Test-Form",            // å›ºå®šFormå‚æ•°
    "time=#{#time()}",           // æ‰§è¡ŒSpELå‡½æ•°
    "apiKey=${local.api.apiKey}" // å–ç¯å¢ƒå˜é‡ä¸­çš„é…ç½®
})
@Post("http://localhost:8080/form")
String formTest4(String name, Integer age, String email);
```

2. **ä½¿ç”¨`@StaticForm`æ³¨è§£çš„`æ¡ä»¶è¡¨è¾¾å¼`æ¥å®Œæˆç‰¹å®šæ¡ä»¶ä¸‹çš„Formå‚æ•°è®¾ç½®**

- `condition`å±æ€§æ¥æ§åˆ¶`ä¸€æ‰¹Form`å‚æ•°çš„è®¾ä¸å¦

```java
/*
    1. timeå±æ€§ä¼šè¢«æ— æ¡ä»¶çš„åŠ å…¥åˆ°Formå‚æ•°ä¸­
    2. åªæœ‰å½“`condition`å±æ€§ç½®é¡¶çš„æ¡ä»¶è¡¨è¾¾å¼`#{userInfo != null}` æˆç«‹æ—¶
        idã€nameã€ageæ‰ä¼šè¢«è®¾ç½®åˆ°Formå‚æ•°ä¸­
 */
@StaticForm({
    "time=#{#time}"    
})
@StaticForm(
    condition = "#{userInfo != null}",
    value = {
        "id=#{userInfo.id}",
        "name=#{userInfo.userName}",
        "age#{userInfo.age}",
    }   
)
@Get("/getOne)
User getUser(User userInfo);
```

- ä½¿ç”¨`@if`è¡¨è¾¾å¼æ¥æ§åˆ¶å•ä¸ªFormå‚æ•°
> è¯­æ³•ä¸ºï¼š`@if(expression): key=value`

```java
/*
    å½“#{#nonNull(userInfo?.id)}è¡¨è¾¾å¼ç»“æœä¸ºtrueæ—¶ï¼Œid=#{userInfo.id} æ‰ä¼šè¢«è®¾ç½®ä¸ºFormå‚æ•°
 */
@StaticForm({
    "time=#{#time()}",
    "@if(#{#nonNull(userInfo?.id)}): id=#{userInfo.id}",    
})
@Get("/getOne)
User getUser(User userInfo);
```
---
### #ä½¿ç”¨`@StaticFormBody`æ³¨è§£æ¥è®¾ç½®`Form`å‚æ•°
è¿™ç§æ–¹å¼ä¸`@StaticForm`ç±»ä¼¼ï¼Œä½†æ˜¯æ­¤ç§æ–¹å¼æ›´åŠ æ¥è¿‘HTTPçš„åŸå§‹æŠ¥æ–‡æ ¼å¼ï¼Œé…ç½®æ•´ä½“ä¸º`String`,å¤šä¸ªkey-valueä¹‹é—´éœ€è¦æ‰‹åŠ¨æ‹¼æ¥è¿æ¥ç¬¦`&`

```java
@StaticFormBody(
    "name=#{p0}&" +
    "name=#{p0}&" +
    "email=#{email}&" +
    "test=Test-Form&" +
    "time=#{#time()}&" +
    "apiKey=${local.api.apiKey}"
)
@Post("http://localhost:8080/form")
String formTest4(String name, Integer age, String email);


// é…åˆå†…ç½®SpELå‡½æ•°#form()ä½¿ç”¨ï¼Œ#form()å‡½æ•°å¯ä»¥ç›´æ¥å°†å¯¹è±¡è½¬ä¸ºFormæ ¼å¼çš„å­—ç¬¦ä¸²
@StaticFormBody("#{#form(p0)}")
@Post("http://localhost:8080/form")
String formTest5(FormEntity objectForm);

// ç›´æ¥è¯»å–classpathä¸‹/form/test.formæ–‡ä»¶çš„å†…å®¹ä½œä¸ºFormå‚æ•°
@StaticFormBody("#{#read(#resource('classpath:/form/test.form'))}")
@Post("http://localhost:8080/form")
String formTest5();
```

