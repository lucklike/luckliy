## ğŸ˜®â€ğŸ’¨è®¾ç½®è‡ªåŠ¨é‡å®šå‘
HTTP é‡å®šå‘æ˜¯æŒ‡åœ¨ Web è¯·æ±‚ä¸­ï¼ŒæœåŠ¡å™¨æŒ‡ç¤ºå®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å°†è¯·æ±‚çš„èµ„æºé‡å®šå‘åˆ°å¦ä¸€ä¸ª URLã€‚é‡å®šå‘é€šå¸¸ç”¨äºä»¥ä¸‹æƒ…å†µï¼š

- èµ„æºå·²ç§»åŠ¨ï¼šä¾‹å¦‚ï¼Œé¡µé¢æˆ–æ–‡ä»¶ä½ç½®å·²æ›´æ”¹ï¼Œå®¢æˆ·ç«¯éœ€è¦è®¿é—®æ–°ä½ç½®ã€‚
- ç½‘ç«™ç»“æ„å˜åŒ–ï¼šä¾‹å¦‚ï¼Œç½‘ç«™çš„ URL ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œä½†ä»éœ€è¦å°†è®¿é—®è€…å¼•å¯¼åˆ°æ–°ä½ç½®ã€‚
- è´Ÿè½½å‡è¡¡ï¼šå°†è¯·æ±‚å¯¼å‘è´Ÿè½½å‡è¡¡å™¨æˆ–ä¸åŒçš„æœåŠ¡å™¨ã€‚

### **HTTP é‡å®šå‘çš„çŠ¶æ€ç **
HTTP é‡å®šå‘é€šå¸¸ç”±æœåŠ¡å™¨è¿”å›ç‰¹å®šçš„çŠ¶æ€ç ï¼Œè¿™äº›çŠ¶æ€ç æŒ‡ç¤ºå®¢æˆ·ç«¯éœ€è¦é‡‡å–çš„æ“ä½œï¼š
1. 301 Moved Permanentlyï¼ˆæ°¸ä¹…ç§»åŠ¨ï¼‰

    
- è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²ç»è¢«æ°¸ä¹…ç§»åŠ¨åˆ°æ–°çš„ URLï¼Œå®¢æˆ·ç«¯åº”è‡ªåŠ¨æ›´æ–°å…¶ä¹¦ç­¾æˆ–é“¾æ¥ã€‚
- ç¤ºä¾‹ï¼š
```http request
HTTP/1.1 301 Moved Permanently
Location: https://new-url.example.com
```

2. 302 Foundï¼ˆä¸´æ—¶ç§»åŠ¨ï¼‰

- è¡¨ç¤ºè¯·æ±‚çš„èµ„æºæš‚æ—¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ª URLï¼Œå®¢æˆ·ç«¯åº”ç»§ç»­ä½¿ç”¨åŸ URL è¿›è¡Œåç»­è¯·æ±‚ã€‚
- ç¤ºä¾‹ï¼š
```http request
HTTP/1.1 302 Found
Location: https://temporary-url.example.com
```

3. 303 See Otherï¼ˆæŸ¥çœ‹å…¶ä»–ï¼‰

- æœåŠ¡å™¨æŒ‡ç¤ºå®¢æˆ·ç«¯åº”ä½¿ç”¨ GET è¯·æ±‚è®¿é—®å¦ä¸€ä¸ª URLã€‚è¿™é€šå¸¸ç”¨äºè¡¨å•æäº¤åçš„é‡å®šå‘ã€‚
- ç¤ºä¾‹ï¼š
```http request
HTTP/1.1 303 See Other
Location: https://another-url.example.com
```

4. 307 Temporary Redirectï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰

- ç±»ä¼¼äº 302ï¼Œè¡¨ç¤ºèµ„æºä¸´æ—¶ç§»åŠ¨ï¼Œä¸”å®¢æˆ·ç«¯åº”ç»§ç»­ä½¿ç”¨ç›¸åŒçš„ HTTP æ–¹æ³•ï¼ˆå¦‚ POSTï¼‰è®¿é—®æ–° URLã€‚
- ç¤ºä¾‹ï¼š
- 
```http request
HTTP/1.1 307 Temporary Redirect
Location: https://new-url.example.com
```

5. 308 Permanent Redirectï¼ˆæ°¸ä¹…é‡å®šå‘ï¼‰

- ç±»ä¼¼äº 301ï¼Œä½†å®¢æˆ·ç«¯åº”ä¿æŒä½¿ç”¨ç›¸åŒçš„ HTTP æ–¹æ³•ï¼ˆå¦‚ POSTï¼‰æ¥è®¿é—®æ–° URLã€‚
- ç¤ºä¾‹ï¼š
```http request
HTTP/1.1 308 Permanent Redirect
Location: https://new-url.example.com
```

### **å¦‚ä½•å·¥ä½œ**
- å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®æŸä¸ª URLï¼‰ã€‚
- æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰ `Location` å¤´çš„ HTTP å“åº”ï¼Œå¹¶é™„å¸¦é‡å®šå‘çŠ¶æ€ç ã€‚
- å®¢æˆ·ç«¯æ ¹æ®çŠ¶æ€ç å’Œ `Location` å¤´çš„å€¼ï¼Œè‡ªåŠ¨å‘æ–°çš„ URL å‘èµ·è¯·æ±‚ã€‚
### **åº”ç”¨åœºæ™¯**
- **URL ç»“æ„å˜åŒ–**ï¼šå½“ç½‘ç«™æ›´æ”¹äº† URL ç»“æ„æ—¶ï¼Œé€šè¿‡ HTTP é‡å®šå‘å°†ç”¨æˆ·å¼•å¯¼åˆ°æ–°é¡µé¢ï¼Œä¿æŒæœç´¢å¼•æ“æ’åå’Œè®¿é—®é“¾æ¥çš„æœ‰æ•ˆæ€§ã€‚
- **ç½‘ç«™è¿ç§»**ï¼šå½“æ•´ä¸ªç½‘ç«™è¿ç§»åˆ°æ–°çš„åŸŸåæˆ–æœåŠ¡å™¨æ—¶ï¼Œä½¿ç”¨ 301 æˆ– 302 çŠ¶æ€ç å°†ç”¨æˆ·ä»æ—§åŸŸåé‡å®šå‘åˆ°æ–°åŸŸåã€‚
- **HTTPS å¼ºåˆ¶**ï¼šå°† HTTP è¯·æ±‚é‡å®šå‘åˆ° HTTPS ç‰ˆæœ¬ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚  
é€šè¿‡åˆç†é…ç½® HTTP é‡å®šå‘ï¼Œå¯ä»¥æ”¹å–„ç”¨æˆ·ä½“éªŒå’Œç½‘ç«™çš„ SEO è¡¨ç°ã€‚

___
### #å…¨å±€ç”Ÿæ•ˆçš„é‡å®šå‘é…ç½®

1. **åŸç”Ÿç¯å¢ƒ**

```java
        HttpClientProxyObjectFactory httpProxy = new HttpClientProxyObjectFactory();
            // æ³¨å†Œé‡å®šå‘æ‹¦æˆªå™¨é…ç½®
            httpProxy.addInterceptor(RedirectInterceptor.class, Scope.METHOD, ri -> {
            // ä¸€æ¬¡è¯·æ±‚å…è®¸çš„æœ€å¤§é‡å®šå‘æ¬¡æ•°
            ri.setMaxRedirectCount(5);
            // é»˜è®¤éœ€è¦è¿›è¡Œé‡å®šå‘æ“ä½œçš„çŠ¶æ€ç 
            ri.setRedirectStatus(new Integer[]{301, 302, 303, 304, 307, 308});
            // # è·å–é‡å®šå‘åœ°å€çš„SpELè¡¨è¾¾å¼
            ri.setRedirectLocationExp("#{$respHeader$.Location}");
            // å†³å®šæ˜¯å¦è¿›è¡Œé‡å®šå‘çš„SpELè¡¨è¾¾å¼ï¼Œæ³¨ï¼šè¯¥é…ç½®çš„ä¼˜å…ˆçº§è¦å¤§äºstatus
            ri.setRedirectCondition("#{You Condition}");
        }, PriorityConstant.REDIRECT_PRIORITY);
```

2. `SpringBoot`ç¯å¢ƒ  
`application.yml`
```yaml
lucky:
  http-client:
    redirect:
      # å¼€å¯é‡å®šå‘åŠŸèƒ½
      enable: true
      # ä¸€æ¬¡è¯·æ±‚å…è®¸çš„æœ€å¤§é‡å®šå‘æ¬¡æ•°
      max-count: 5
      # é»˜è®¤éœ€è¦è¿›è¡Œé‡å®šå‘æ“ä½œçš„çŠ¶æ€ç 
      status: [301, 302, 303, 304, 307, 308]
      # è·å–é‡å®šå‘åœ°å€çš„SpELè¡¨è¾¾å¼
      location: "#{$repHeader$.Location}"
      # å†³å®šæ˜¯å¦è¿›è¡Œé‡å®šå‘çš„SpELè¡¨è¾¾å¼ï¼Œæ³¨ï¼šè¯¥é…ç½®çš„ä¼˜å…ˆçº§è¦å¤§äºstatus
      condition: "#{You Condition}"
```

---
### #ä½¿ç”¨`@AutoRedirect`æ³¨è§£æ¥è¿›è¡Œç±»çº§åˆ«æˆ–è€…æ–¹æ³•çº§åˆ«çš„é‡å®šå‘é…ç½®

> å°†`@AutoRedirect`æ³¨è§£æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šè¡¨ç¤ºè¯¥æ–¹æ³•ä¸­çš„æ‰€æœ‰æ–¹æ³•å‡æ”¯æŒè‡ªåŠ¨é‡å®šå‘

```java
@DomainName("http://localhot:8080/")
public interface RedirectDemoApi {

    @AutoRedirect
    @Get("/redirect")
    String redirect();

    // è‡ªå®šä¹‰é‡å®šå‘é€»è¾‘
    // ä¾‹å¦‚å½“æ£€æµ‹åˆ°çŠ¶æ€ç ä¸º404æ—¶ï¼Œé‡å®šå‘åˆ°
    /*
        è‡ªå®šä¹‰é‡å®šå‘é€»è¾‘
        ä¾‹å¦‚ï¼š
        é‡å®šå‘æ¡ä»¶ï¼š
            1.çŠ¶æ€ç ï¼š404
            2.å…¥å‚tagä¸º"R"
        é‡å®šå‘åœ°å€ï¼š
            http://localhost:8080/404        
     */
    @AutoRedirect(
        location = "http://localhost:8080/404",
        condition = "#{($status$ == 404) and ('R' eq tag) }"
    )
    @Get("redirect")
    String customRedirect(String tag);
    
}
```
é‡å®šå‘æ—¥å¿—å¦‚ä¸‹ï¼š
![é‡å®šå‘æ—¥å¿—](../../image/log-redirect.jpg)