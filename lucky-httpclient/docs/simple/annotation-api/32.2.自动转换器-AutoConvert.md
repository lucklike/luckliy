## ğŸ° è‡ªåŠ¨è½¬æ¢å™¨[ï¼ˆResponse.AutoConvertï¼‰](../../../src/main/java/com/luckyframework/httpclient/core/meta/Response.java)

`è‡ªåŠ¨è½¬æ¢å™¨`åˆç§°`é€šç”¨è½¬æ¢å™¨`ï¼Œè¯¥è½¬æ¢å™¨é€šå¸¸ç”¨æ¥å¤„ç†æŸç§`é€šç”¨çš„æ•°æ®æ ¼å¼`ï¼Œæ­¤æ¥å£æ˜¯å¯¹`Response#getEntity()`æ–¹æ³•çš„æ‰©å±•

---

### # è½¬æ¢å™¨æ¥å£æ–¹æ³•ä»‹ç»

```java
    interface AutoConvert {


    /**
     * æ­¤è½¬æ¢å™¨æ˜¯å¦å¯ä»¥å¤„ç†å½“å‰è¯·æ±‚çš„å“åº”
     *
     * @param resp å“åº”å¯¹è±¡
     * @param type è½¬æ¢çš„ç›®æ ‡ç±»å‹
     * @return true/false
     */
    boolean can(Response resp, Type type);

    /**
     * å°†å½“å‰è¯·æ±‚çš„å“åº”å¯¹è±¡è½¬æ¢ä¸ºç›®æ ‡ç±»å‹çš„å®ä¾‹
     *
     * @param resp å“åº”å¯¹è±¡
     * @param type è½¬æ¢çš„ç›®æ ‡ç±»å‹
     * @param <T>  è½¬æ¢ç›®æ ‡ç±»å‹æ³›å‹
     * @return è½¬æ¢çš„ç›®æ ‡ç±»å‹å¯¹è±¡
     */
    <T> T convert(Response resp, Type type);
}
```

---

### # æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨

- `åŸç”ŸJavaç¯å¢ƒ`

    ä½¿ç”¨[Response](../../../src/main/java/com/luckyframework/httpclient/core/meta/Response.java)ç±»çš„å¦‚ä¸‹`é™æ€æ–¹æ³•`è¿›è¡Œæ³¨å†Œ
    
    - `void addAutoConvert(AutoConvert autoConvert)`ï¼šæ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆé˜Ÿå°¾æ·»åŠ ï¼‰
    - `void addAutoConvert(int index, AutoConvert autoConvert)`ï¼šæ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆæŒ‡å®šä½ç½®æ·»åŠ ï¼‰
    - `void setAutoConvert(int index, AutoConvert autoConvert)`ï¼šæ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆæŒ‡å®šä½ç½®è¦†ç›–æ·»åŠ ï¼‰
    - `void coverAutoConvert(Class<? extends AutoConvert> clazz, AutoConvert autoConvert)`ï¼šæ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆæ·»åŠ å¹¶è¦†ç›–æŒ‡å®šç±»å‹çš„è½¬æ¢å™¨ï¼‰  

    **å®ä¾‹ä»£ç **ï¼š
    ```java
    public class LuckyConfig {
        static {
            // æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆé˜Ÿå°¾æ·»åŠ ï¼‰
            Response.addAutoConvert(new JsonAutoConvert());
            // æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆæŒ‡å®šä½ç½®æ·»åŠ ï¼‰
            Response.addAutoConvert(0, new TestAutoConvert());
            // æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆæŒ‡å®šä½ç½®è¦†ç›–æ·»åŠ ï¼‰
            Response.setAutoConvert(1, new YouAutoConvert());
            // æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆæ·»åŠ å¹¶è¦†ç›–æŒ‡å®šç±»å‹çš„è½¬æ¢å™¨ï¼‰
            Response.coverAutoConvert(JsonAutoConvert.class, new YouJsonAutoConvert());
        } 
    } 
    ```


- `SpringBootç¯å¢ƒ`
    1. é€šè¿‡`application.yml`é…ç½®æ–‡ä»¶æ³¨å†Œ
    ```yaml
    lucky:
      http-client:
        response-convert:
          auto-converts:
            # æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆé˜Ÿå°¾æ·»åŠ ï¼‰
            - clazz: com.luckyframework.httpclient.core.convert.JsonAutoConvert
    
            # æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆæŒ‡å®šä½ç½®æ·»åŠ ï¼‰
            - index: 1
              clazz: com.luckyframework.httpclient.core.convert.JsonAutoConvert
    
            # æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆå·²æœ‰ç±»å‹å®šä½æ–¹å¼ï¼‰
            - index-class: com.luckyframework.httpclient.core.convert.ProtobufAutoConvert
              clazz: com.luckyframework.httpclient.core.convert.MyProtobufAutoConvert
              
            # æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆæŒ‡å®šä½ç½®è¦†ç›–ï¼‰  
            - type: cover
              index: 1
              clazz: com.luckyframework.httpclient.core.convert.JsonAutoConvert
            
            # æ³¨å†Œè‡ªåŠ¨è½¬æ¢å™¨ï¼ˆå·²æœ‰ç±»å‹å®šä½æ–¹å¼è¦†ç›–ï¼‰
            - type: cover  
              index-class: com.luckyframework.httpclient.core.convert.ProtobufAutoConvert
              clazz: com.luckyframework.httpclient.core.convert.MyProtobufAutoConvert
    ```
    2. é€šè¿‡`Spring Bean`æ–¹å¼æ³¨å†Œ

    ```java
    import com.luckyframework.httpclient.core.convert.JsonAutoConvert;
    import org.springframework.beans.factory.annotation.Configurable;
  
    @Configurable
    public class LuckyConfiguration {
        
        @Bean
        public JsonAutoConvert jsonTxtAutoConvert() {
            return new JsonAutoConvert();
        }
    }
    ```
  
    ```java
    import com.luckyframework.httpclient.core.convert.JsonAutoConvert;
    import com.luckyframework.httpclient.core.meta.Response;
    import io.github.lucklike.httpclient.config.IAutoConvert;
    import io.github.lucklike.httpclient.config.RType;
    import org.springframework.stereotype.Component;
    
    import javax.annotation.Resource;
    import java.lang.reflect.Type;
  
    @Component
    public class MyJsonAutoConvert implements IAutoConvert {
    
        @Resource
        private JsonAutoConvert jsonAutoConvert;
    
        @Override
        public boolean can(Response resp, Type type) {
            return jsonAutoConvert.can(resp, type);
        }
    
        @Override
        public <T> T convert(Response resp, Type type) {
            return jsonAutoConvert.convert(resp, type);
        }
    
        // ä½¿ç”¨è¦†ç›–çš„æ–¹å¼æ³¨å†Œ
        @Override
        public RType rType() {
            return RType.COVER;
        }
  
        // ä½ç½®å®šä½
        @Override
        public Integer index() {
            return IAutoConvert.super.index();
        }

    
        // è¦†ç›–ç±»å‹ä¸ºJsonAutoConvertçš„è‡ªåŠ¨è½¬æ¢å™¨
        @Override
        public Class<? extends Response.AutoConvert> indexClass() {
            return JsonAutoConvert.class;
        }
    }
    ```
    

---

### # åˆ©ç”¨`Response.AutoConvert`å°†æ¢é»˜è®¤çš„Jsonåºåˆ—åŒ–æ–¹æ¡ˆæ”¹ä¸º`Gsno`

```java
import com.alibaba.nacos.shaded.com.google.gson.Gson;
import com.luckyframework.httpclient.core.meta.ContentType;
import com.luckyframework.httpclient.core.meta.Response;
import org.springframework.stereotype.Component;

import java.lang.reflect.Type;

@Component
public class GsonAutoConvert implements Response.AutoConvert{
    
    private final Gson gson = new Gson();
    
    @Override
    public boolean can(Response resp, Type type) {
        String mimeType = resp.getContentType().getMimeType();
        return ContentType.APPLICATION_JSON.getMimeType().equalsIgnoreCase(mimeType);
    }

    @Override
    public <T> T convert(Response resp, Type type) {
        return gson.fromJson(resp.getStringResult(), type);
    }
}
```
åŒç†ï¼Œä½ å¯ä»¥ä½¿ç”¨`Response.AutoConvert`æ¥æ›¿æ¢å…¶ä»–çš„åºåˆ—åŒ–æ–¹æ¡ˆï¼Œæˆ–è€…æ‰©å±•å…¶ä»–çš„ç‰¹æ®Šé€šç”¨æ•°æ®æ ¼å¼çš„è½¬æ¢

---

### # å·²å®ç°çš„è‡ªåŠ¨è½¬æ¢å™¨

| å·²æœ‰å®ç°ç±»                                                                                                                                   | è¯´æ˜                                                            | è‡ªåŠ¨æ³¨å†Œæ—¶æœº                                  |
|-----------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-----------------------------------------|
| [ProtobufAutoConvert](../../../src/main/java/com/luckyframework/httpclient/core/convert/ProtobufAutoConvert.java)                       | æä¾›å¯¹`application/x-protobuf`æ ¼å¼æ•°æ®è‡ªåŠ¨è½¬æ¢çš„èƒ½åŠ›                        | `SpringBootç¯å¢ƒ`ï¼Œå¹¶æ£€æµ‹åˆ°`å­˜åœ¨protobufä¾èµ–åŒ…`æ—¶è‡ªåŠ¨æ³¨å†Œ |
| [SpringMultipartFileAutoConvert](../../../src/main/java/com/luckyframework/httpclient/core/convert/SpringMultipartFileAutoConvert.java) | å¤„ç†è¿”å›å€¼ä¸º`Spring MultipartFile`ç±»å‹çš„ç»“æœè‡ªåŠ¨è½¬æ¢                         | `SpringBootç¯å¢ƒ`ï¼Œå¹¶æ£€æµ‹åˆ°ä¸º`Webç¯å¢ƒ`æ—¶è‡ªåŠ¨æ³¨å†Œ        |
| [JsonAutoConvert](../../../src/main/java/com/luckyframework/httpclient/core/convert/JsonAutoConvert.java)                               | æä¾›`Content-Type != application/json`,ä½†æ˜¯å“åº”ä½“åˆç¡®å®ä¸ºJSONæ ¼å¼æ•°æ®çš„è‡ªåŠ¨è½¬æ¢èƒ½åŠ› | ä¸è‡ªåŠ¨æ³¨å†Œ                                   |


